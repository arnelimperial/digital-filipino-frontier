var r=function(s){var i={settings:{preload:!1,slideDuration:500,layoutDuration:750,thumbnailsPerRow:2,mainSide:"right"},$window:null,$body:null,$main:null,$thumbnails:null,$viewer:null,$toggle:null,$navNext:null,$navPrevious:null,slides:[],current:null,locked:!1,keys:{27:function(){i.toggle()},38:function(){i.up()},40:function(){i.down()},32:function(){i.next()},39:function(){i.next()},37:function(){i.previous()}},initProperties:function(){i.$window=s(window),i.$body=s("body"),i.$thumbnails=s("#thumbnails"),i.$viewer=s('<div id="viewer"><div class="inner"><div class="nav-next"></div><div class="nav-previous"></div><div class="toggle"></div></div></div>').appendTo(i.$body),i.$navNext=i.$viewer.find(".nav-next"),i.$navPrevious=i.$viewer.find(".nav-previous"),i.$main=s("#main"),s('<div class="toggle"></div>').appendTo(i.$main),i.$toggle=s(".toggle")},initEvents:function(){i.$window.on("load",function(){i.$body.removeClass("is-preload-0"),window.setTimeout(function(){i.$body.removeClass("is-preload-1")},100),window.setTimeout(function(){i.$body.removeClass("is-preload-2")},100+Math.max(i.settings.layoutDuration-150,0))});var t;i.$window.on("resize",function(){i.$body.addClass("is-preload-0"),window.clearTimeout(t),t=window.setTimeout(function(){i.$body.removeClass("is-preload-0")},100)}),i.$viewer.on("touchend",function(){breakpoints.active("<=medium")&&i.hide()}),i.$viewer.on("touchstart",function(e){i.$viewer.touchPosX=e.originalEvent.touches[0].pageX,i.$viewer.touchPosY=e.originalEvent.touches[0].pageY}).on("touchmove",function(e){if(!(i.$viewer.touchPosX===null||i.$viewer.touchPosY===null)){var o=i.$viewer.touchPosX-e.originalEvent.touches[0].pageX,n=i.$viewer.touchPosY-e.originalEvent.touches[0].pageY;boundary=20,delta=50,n<boundary&&n>-1*boundary&&o>delta?i.next():n<boundary&&n>-1*boundary&&o<-1*delta&&i.previous();var l=i.$viewer.outerHeight(),a=i.$viewer.get(0).scrollHeight-i.$viewer.scrollTop();(i.$viewer.scrollTop()<=0&&n<0||a>l-2&&a<l+2&&n>0)&&(e.preventDefault(),e.stopPropagation())}}),i.$main.on("touchstart",function(e){breakpoints.active("<=xsmall")||(i.$main.touchPosX=e.originalEvent.touches[0].pageX,i.$main.touchPosY=e.originalEvent.touches[0].pageY)}).on("touchmove",function(e){if(!breakpoints.active("<=xsmall")&&!(i.$main.touchPosX===null||i.$main.touchPosY===null)){var o=i.$main.touchPosX-e.originalEvent.touches[0].pageX,n=i.$main.touchPosY-e.originalEvent.touches[0].pageY;switch(boundary=20,delta=50,result=!1,i.settings.mainSide){case"left":result=n<boundary&&n>-1*boundary&&o>delta;break;case"right":result=n<boundary&&n>-1*boundary&&o<-1*delta;break}result&&i.hide();var l=i.$main.outerHeight(),a=i.$main.get(0).scrollHeight-i.$main.scrollTop();(i.$main.scrollTop()<=0&&n<0||a>l-2&&a<l+2&&n>0)&&(e.preventDefault(),e.stopPropagation())}}),i.$toggle.on("click",function(){i.toggle()}),i.$toggle.on("touchend",function(e){e.stopPropagation()}),i.$navNext.on("click",function(){i.next()}),i.$navPrevious.on("click",function(){i.previous()}),i.$body.on("keydown","input,select,textarea",function(e){e.stopPropagation()}),i.$window.on("keydown",function(e){breakpoints.active("<=xsmall")||e.keyCode in i.keys&&(e.stopPropagation(),e.preventDefault(),i.keys[e.keyCode]())})},initViewer:function(){i.$thumbnails.on("click",".thumbnail",function(t){var e=s(this);t.preventDefault(),t.stopPropagation(),i.locked&&e.blur(),i.switchTo(e.data("index"))}),i.$thumbnails.children().each(function(){var t=s(this),e=t.children(".thumbnail"),o;o={$parent:t,$slide:null,$slideImage:null,$slideCaption:null,url:e.attr("href"),loaded:!1},t.attr("tabIndex","-1"),o.$slide=s('<div class="slide"><div class="caption"></div><div class="image"></div></div>'),o.$slideImage=o.$slide.children(".image"),o.$slideImage.css("background-image","").css("background-position",e.data("position")||"center"),o.$slideCaption=o.$slide.find(".caption"),t.children().not(e).appendTo(o.$slideCaption),i.slides.push(o),e.data("index",i.slides.length-1)})},init:function(){breakpoints({xlarge:["1281px","1680px"],large:["981px","1280px"],medium:["737px","980px"],small:["481px","736px"],xsmall:[null,"480px"]}),i.initProperties(),i.initViewer(),i.initEvents(),breakpoints.on(">xsmall",function(){i.current===null&&i.switchTo(0,!0)})},switchTo:function(t,e){if(!(i.current==t&&!breakpoints.active("<=xsmall"))&&!i.locked){i.locked=!0,!e&&breakpoints.active("<=medium")&&i.hide();var o=i.current!==null?i.slides[i.current]:null,n=i.slides[t];i.current=t,o&&(o.$parent.removeClass("active"),o.$slide.removeClass("active")),n.$parent.addClass("active").focus();var l=function(){o&&o.$slide.detach(),n.$slide.appendTo(i.$viewer),n.loaded?window.setTimeout(function(){n.$slide.addClass("active"),window.setTimeout(function(){i.locked=!1},100)},100):window.setTimeout(function(){n.$slide.addClass("loading"),s('<img src="'+n.url+'" />').on("load",function(){n.$slideImage.css("background-image","url("+n.url+")"),n.loaded=!0,n.$slide.removeClass("loading"),n.$slide.addClass("active"),window.setTimeout(function(){i.locked=!1},100)})},100)};o?window.setTimeout(l,i.settings.slideDuration):l()}},next:function(){var t,e=i.current,o=i.slides.length;e>=o-1?t=0:t=e+1,i.switchTo(t)},previous:function(){var t,e=i.current,o=i.slides.length;e<=0?t=o-1:t=e-1,i.switchTo(t)},up:function(){if(!i.$body.hasClass("fullscreen")){var t,e=i.current,o=i.slides.length,n=i.settings.thumbnailsPerRow;e<=n-1?t=o-(n-1-e)-1:t=e-n,i.switchTo(t)}},down:function(){if(!i.$body.hasClass("fullscreen")){var t,e=i.current,o=i.slides.length,n=i.settings.thumbnailsPerRow;e>=o-n?t=e-o+n:t=e+n,i.switchTo(t)}},show:function(){i.$body.hasClass("fullscreen")&&(i.$body.removeClass("fullscreen"),i.$main.focus())},hide:function(){i.$body.hasClass("fullscreen")||(i.$body.addClass("fullscreen"),i.$main.blur())},toggle:function(){i.$body.hasClass("fullscreen")?i.show():i.hide()}};return i}(jQuery);r.init();
